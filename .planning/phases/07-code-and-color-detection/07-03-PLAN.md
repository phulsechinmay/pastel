---
phase: 07-code-and-color-detection
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - Pastel/Views/Panel/ColorCardView.swift
  - Pastel/Views/Panel/ClipboardCardView.swift
autonomous: false

must_haves:
  truths:
    - "Copying a hex color shows a colored swatch rectangle alongside the color text"
    - "Copying rgb(255, 87, 51) shows a swatch with the correct orange-red color"
    - "The color swatch renders at a visible size with a subtle border"
    - "ClipboardCardView routes .code items to CodeCardView and .color items to ColorCardView"
    - "Existing text, richText, url, image, file cards are unaffected by routing changes"
    - "Color cards adapt line limits for horizontal/vertical panel orientation"
  artifacts:
    - path: "Pastel/Views/Panel/ColorCardView.swift"
      provides: "Color swatch + text display card for .color items"
      contains: "ColorCardView"
    - path: "Pastel/Views/Panel/ClipboardCardView.swift"
      provides: "Updated routing to CodeCardView for .code and ColorCardView for .color"
      contains: "CodeCardView"
  key_links:
    - from: "Pastel/Views/Panel/ClipboardCardView.swift"
      to: "Pastel/Views/Panel/ColorCardView.swift"
      via: "case .color: ColorCardView(item: item)"
      pattern: "ColorCardView\\(item:"
    - from: "Pastel/Views/Panel/ClipboardCardView.swift"
      to: "Pastel/Views/Panel/CodeCardView.swift"
      via: "case .code: CodeCardView(item: item)"
      pattern: "CodeCardView\\(item:"
    - from: "Pastel/Views/Panel/ColorCardView.swift"
      to: "ClipboardItem.detectedColorHex"
      via: "Reads detectedColorHex to render swatch color"
      pattern: "item\\.detectedColorHex"
---

<objective>
Create ColorCardView with visual color swatch and update ClipboardCardView routing to send .code items to CodeCardView and .color items to ColorCardView.

Purpose: This plan delivers requirement RICH-05 (color swatch display) and completes the card routing for all Phase 7 content types. After this plan, both code and color items have dedicated visual card treatments.

Output: ColorCardView.swift with swatch rendering; updated ClipboardCardView dispatching .code and .color to their respective card views.
</objective>

<execution_context>
@/Users/phulsechinmay/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phulsechinmay/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-code-and-color-detection/07-RESEARCH.md
@.planning/phases/07-code-and-color-detection/07-01-SUMMARY.md

@Pastel/Views/Panel/ClipboardCardView.swift
@Pastel/Views/Panel/TextCardView.swift
@Pastel/Views/Panel/URLCardView.swift
@Pastel/Models/ClipboardItem.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ColorCardView with color swatch</name>
  <files>
    Pastel/Views/Panel/ColorCardView.swift
  </files>
  <action>
Create a new SwiftUI view `ColorCardView` in `Pastel/Views/Panel/ColorCardView.swift`.

The layout follows the URLCardView HStack pattern: a visual element on the left + text content on the right.

```swift
import SwiftUI

struct ColorCardView: View {
    let item: ClipboardItem
    @AppStorage("panelEdge") private var panelEdgeRaw: String = PanelEdge.right.rawValue

    private var isHorizontal: Bool {
        let edge = PanelEdge(rawValue: panelEdgeRaw) ?? .right
        return !edge.isVertical
    }

    /// Parse the 6-digit hex string into a SwiftUI Color
    private var swatchColor: Color {
        guard let hex = item.detectedColorHex, hex.count == 6 else {
            return .gray
        }
        let scanner = Scanner(string: hex)
        var rgb: UInt64 = 0
        scanner.scanHexInt64(&rgb)
        return Color(
            red: Double((rgb >> 16) & 0xFF) / 255.0,
            green: Double((rgb >> 8) & 0xFF) / 255.0,
            blue: Double(rgb & 0xFF) / 255.0
        )
    }

    var body: some View {
        HStack(spacing: 10) {
            // Color swatch rectangle
            RoundedRectangle(cornerRadius: 6)
                .fill(swatchColor)
                .frame(width: 32, height: 32)
                .overlay(
                    RoundedRectangle(cornerRadius: 6)
                        .strokeBorder(Color.white.opacity(0.2), lineWidth: 1)
                )

            // Color text value (e.g., "#FF5733" or "rgb(255, 87, 51)")
            VStack(alignment: .leading, spacing: 2) {
                Text(item.textContent ?? "")
                    .font(.system(.callout, design: .monospaced))
                    .lineLimit(isHorizontal ? 2 : 1)
                    .foregroundStyle(.primary)

                // Show normalized hex below if the original text is not hex
                if let hex = item.detectedColorHex,
                   let text = item.textContent?.trimmingCharacters(in: .whitespacesAndNewlines),
                   !text.lowercased().hasPrefix("#") {
                    Text("#\(hex)")
                        .font(.system(size: 10, design: .monospaced))
                        .foregroundStyle(.secondary)
                }
            }

            Spacer()
        }
        .frame(maxWidth: .infinity, alignment: .leading)
    }
}
```

**Key design decisions:**
- 32x32 swatch with 6pt corner radius and subtle white border (matches research recommendation)
- Monospaced font for the color value text (these are code-like values)
- If the original text is rgb()/hsl() format, show the normalized hex below as a secondary label (user sees both their original input and the hex equivalent)
- Swatch has a white border at 0.2 opacity so dark colors (like #000000) are still visible against the dark panel
- Falls back to gray swatch if detectedColorHex is somehow nil or malformed
  </action>
  <verify>
Build succeeds: `cd /Users/phulsechinmay/Desktop/Projects/pastel && xcodebuild build -project Pastel.xcodeproj -scheme Pastel -destination 'platform=macOS' 2>&1 | tail -5`
  </verify>
  <done>
ColorCardView renders a color swatch alongside the original color text. Shows normalized hex for non-hex inputs. Adapts to panel orientation. Falls back gracefully for missing hex data.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update ClipboardCardView routing for .code and .color</name>
  <files>
    Pastel/Views/Panel/ClipboardCardView.swift
  </files>
  <action>
Update the `contentPreview` computed property in ClipboardCardView to route .code and .color to their new dedicated views.

Change the switch statement from:
```swift
case .code:
    TextCardView(item: item)
case .color:
    TextCardView(item: item)
```

To:
```swift
case .code:
    CodeCardView(item: item)
case .color:
    ColorCardView(item: item)
```

That's it -- two lines changed. The existing `cardMinHeight` should remain unchanged (80pt for non-image types is fine for both code and color cards).
  </action>
  <verify>
Build succeeds: `cd /Users/phulsechinmay/Desktop/Projects/pastel && xcodebuild build -project Pastel.xcodeproj -scheme Pastel -destination 'platform=macOS' 2>&1 | tail -5`

Verify routing by reading ClipboardCardView.swift and confirming .code -> CodeCardView and .color -> ColorCardView.
  </verify>
  <done>
ClipboardCardView routes .code to CodeCardView and .color to ColorCardView. All other content types are unaffected.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
ColorCardView with visual swatch rendering. ClipboardCardView now routes all 7 content types to their dedicated card views: text, richText -> TextCardView, url -> URLCardView, image -> ImageCardView, file -> FileCardView, code -> CodeCardView, color -> ColorCardView.
  </what-built>
  <how-to-verify>
1. Build and run the app
2. Copy "#FF5733" from a text editor -> panel should show an orange-red swatch rectangle with the text "#FF5733"
3. Copy "rgb(0, 128, 255)" -> panel should show a blue swatch with "rgb(0, 128, 255)" text and "#0080FF" below it
4. Copy "hsl(120, 100%, 50%)" -> panel should show a green swatch
5. Copy "#000" -> panel should show a black swatch with visible white border
6. Copy a multi-line Swift function -> panel should show syntax-highlighted code with a language badge (from Plan 07-02)
7. Copy "Hello world, this is a normal sentence" -> should show as a normal text card (no swatch, no highlighting)
8. Copy a URL like "https://example.com" -> should still show as a URL card (globe icon, blue text)
9. Verify no visual regressions on existing card types
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Build succeeds with zero errors
2. ColorCardView renders swatches for hex, rgb, and hsl values
3. Swatch border is visible on dark colors
4. Normalized hex is shown below non-hex color inputs
5. ClipboardCardView routes .code -> CodeCardView and .color -> ColorCardView
6. All 5 existing card types (text, richText, url, image, file) still render correctly
7. No visual regressions in the panel
</verification>

<success_criteria>
- Color cards show visual swatches with correct colors for all supported formats
- Card routing is complete for all 7 content types
- No regressions on existing card types
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/07-code-and-color-detection/07-03-SUMMARY.md`
</output>
