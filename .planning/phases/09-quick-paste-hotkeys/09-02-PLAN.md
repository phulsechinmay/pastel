---
phase: 09-quick-paste-hotkeys
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - Pastel/Views/Panel/ClipboardCardView.swift
  - Pastel/Views/Panel/FilteredCardListView.swift
autonomous: true

must_haves:
  truths:
    - "User opens panel and the first 9 cards show keycap-style position badges (⌘ 1 through ⌘ 9) in their bottom-right corners"
    - "User opens panel with 15 items and only the first 9 cards have badges; cards 10-15 have no badge"
    - "User disables quick paste in Settings and all position badges disappear from cards"
    - "User filters to 3 items by label and badges show ⌘ 1, ⌘ 2, ⌘ 3 on those 3 cards"
  artifacts:
    - path: "Pastel/Views/Panel/ClipboardCardView.swift"
      provides: "KeycapBadge view and badge overlay on cards"
      contains: "KeycapBadge"
    - path: "Pastel/Views/Panel/FilteredCardListView.swift"
      provides: "Badge position index passed to ClipboardCardView"
      contains: "badgePosition"
  key_links:
    - from: "FilteredCardListView.swift"
      to: "ClipboardCardView.swift"
      via: "badgePosition parameter (nil for index >= 9 or quick paste disabled)"
      pattern: "badgePosition"
    - from: "ClipboardCardView.swift"
      to: "@AppStorage quickPasteEnabled"
      via: "Badge visibility gated by setting"
      pattern: "quickPasteEnabled"
---

<objective>
Add keycap-style position badges (⌘ 1 through ⌘ 9) to the bottom-right corner of the first 9 visible cards in the panel, with visibility tied to the quickPasteEnabled setting.

Purpose: Visual affordance showing users which number key to press for quick paste. Badges match the hotkey behavior from Plan 01 -- the Nth badge corresponds to Cmd+N.

Output: KeycapBadge SwiftUI view, badge overlay on ClipboardCardView, badge position index passed from FilteredCardListView.
</objective>

<execution_context>
@/Users/phulsechinmay/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phulsechinmay/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-quick-paste-hotkeys/09-CONTEXT.md
@.planning/phases/09-quick-paste-hotkeys/09-RESEARCH.md
@.planning/phases/09-quick-paste-hotkeys/09-01-SUMMARY.md
@Pastel/Views/Panel/ClipboardCardView.swift
@Pastel/Views/Panel/FilteredCardListView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create KeycapBadge view and add badge overlay to ClipboardCardView</name>
  <files>
    Pastel/Views/Panel/ClipboardCardView.swift
  </files>
  <action>
**Add KeycapBadge struct** at the bottom of ClipboardCardView.swift (below the ClipboardCardView struct, same file):

```swift
/// Keyboard key-style badge showing a quick paste shortcut (e.g., "⌘ 1").
/// Mimics a physical keycap with rounded rect background and subtle border.
struct KeycapBadge: View {
    let number: Int  // 1-9

    var body: some View {
        HStack(spacing: 2) {
            Text("\u{2318}")  // ⌘ symbol
                .font(.system(size: 9, weight: .medium))
            Text("\(number)")
                .font(.system(size: 10, weight: .semibold, design: .rounded))
        }
        .foregroundStyle(.white.opacity(0.7))
        .padding(.horizontal, 5)
        .padding(.vertical, 3)
        .background(
            RoundedRectangle(cornerRadius: 4)
                .fill(.white.opacity(0.15))
        )
        .overlay(
            RoundedRectangle(cornerRadius: 4)
                .strokeBorder(.white.opacity(0.1), lineWidth: 0.5)
        )
    }
}
```

**Add badge properties to ClipboardCardView:**
- Add a new optional init parameter: `badgePosition: Int? = nil` (1-based number, nil means no badge). Update the existing `init(item:isSelected:onPaste:)` to include this parameter with a default of `nil`.

**Add badge overlay to ClipboardCardView body:**
After the existing `.clipShape(RoundedRectangle(cornerRadius: 10))` line and before `.onHover`, add an overlay:

```swift
.overlay(alignment: .bottomTrailing) {
    if let badgePosition {
        KeycapBadge(number: badgePosition)
            .padding(6)
    }
}
```

This places the badge in the bottom-right corner of the card with 6pt inset. The badge only appears when `badgePosition` is non-nil. The calling code (FilteredCardListView) controls when to pass a position vs nil.

**IMPORTANT:** Do NOT read `@AppStorage("quickPasteEnabled")` inside ClipboardCardView. The FilteredCardListView already has this storage property (from Plan 01) and will pass `badgePosition: nil` when disabled. This keeps badge visibility logic centralized in one place.
  </action>
  <verify>
Build the project with `xcodebuild build -scheme Pastel -destination 'platform=macOS'`. Verify no compilation errors.
  </verify>
  <done>
ClipboardCardView has a `badgePosition: Int?` init parameter and renders a KeycapBadge overlay in the bottom-right corner when non-nil. KeycapBadge is a keyboard-key-styled SwiftUI view with ⌘ symbol and digit, muted white-on-dark coloring.
  </done>
</task>

<task type="auto">
  <name>Task 2: Pass badge position from FilteredCardListView to ClipboardCardView</name>
  <files>
    Pastel/Views/Panel/FilteredCardListView.swift
  </files>
  <action>
**Update all ClipboardCardView call sites** in FilteredCardListView to pass `badgePosition`. There are two call sites (horizontal layout and vertical layout). Both use the same `ForEach(Array(items.enumerated()), id: \.element.id) { index, item in` pattern.

The badge position logic: if `quickPasteEnabled` is true AND `index < 9`, pass `badgePosition: index + 1` (convert 0-based to 1-based). Otherwise pass `badgePosition: nil`.

Compute the badge position as a local variable for clarity. In BOTH ForEach bodies (horizontal and vertical), update the ClipboardCardView init:

```swift
let badge: Int? = quickPasteEnabled && index < 9 ? index + 1 : nil
ClipboardCardView(
    item: item,
    isSelected: selectedIndex == index,
    badgePosition: badge
)
```

The `@AppStorage("quickPasteEnabled")` property already exists in FilteredCardListView from Plan 01's Task 2. Reuse it directly.

**IMPORTANT:** Do not change any other behavior. The `.onTapGesture`, `.id()`, `.frame()`, `.clipped()` modifiers remain exactly as they are. Only the ClipboardCardView initializer call changes to include `badgePosition`.
  </action>
  <verify>
Build the project with `xcodebuild build -scheme Pastel -destination 'platform=macOS'`. Verify no compilation errors. Verify that the `badgePosition` parameter is passed in BOTH the horizontal and vertical ForEach loops.
  </verify>
  <done>
FilteredCardListView passes `badgePosition: index + 1` to the first 9 cards (when `quickPasteEnabled` is true) and `nil` to all other cards. Badge numbers match the quick paste hotkey numbers (⌘ 1 = first card, ⌘ 9 = ninth card). When quick paste is disabled in Settings, all badges disappear because `badgePosition` is always nil.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `xcodebuild build -scheme Pastel -destination 'platform=macOS'`
2. No warnings or errors related to badge code
3. Verify `ClipboardCardView` has `badgePosition: Int?` parameter and `KeycapBadge` overlay
4. Verify `FilteredCardListView` passes badge position in BOTH horizontal and vertical layout branches
5. Verify badge position is 1-based (⌘ 1 through ⌘ 9), not 0-based
6. Verify badge only appears for first 9 items (index < 9)
7. Verify badge is hidden when `quickPasteEnabled` is false
</verification>

<success_criteria>
- First 9 visible cards show keycap badges (⌘ 1 through ⌘ 9) in bottom-right corner
- Cards beyond position 9 have no badge
- Badges disappear when quick paste is disabled in Settings
- Badges update correctly when filtering (filtered view shows ⌘ 1-N for visible items)
- Badge styling is muted (white/0.7 text on white/0.15 background) to not overwhelm card content
- Existing card interactions (hover, selection, click, context menu) are unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/09-quick-paste-hotkeys/09-02-SUMMARY.md`
</output>
