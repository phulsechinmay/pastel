---
phase: 12-history-browser-and-bulk-actions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Pastel/Views/Settings/SettingsWindowController.swift
  - Pastel/Views/Settings/SettingsView.swift
  - Pastel/Views/Settings/HistoryBrowserView.swift
autonomous: true

must_haves:
  truths:
    - "Settings window is resizable and responds to drag-resizing"
    - "User sees a History tab in the settings tab bar alongside General and Labels"
    - "Clicking History tab shows a view with search field and chip bar at the top"
    - "General and Labels tabs remain at their fixed width, centered in the window"
  artifacts:
    - path: "Pastel/Views/Settings/SettingsWindowController.swift"
      provides: "Resizable NSWindow with .resizable styleMask and minSize constraint"
      contains: ".resizable"
    - path: "Pastel/Views/Settings/SettingsView.swift"
      provides: "History tab case in SettingsTab enum, conditional frame sizing per tab"
      contains: "case history"
    - path: "Pastel/Views/Settings/HistoryBrowserView.swift"
      provides: "Root history tab view with search, chip bar, and placeholder for grid"
      min_lines: 60
  key_links:
    - from: "Pastel/Views/Settings/SettingsView.swift"
      to: "Pastel/Views/Settings/HistoryBrowserView.swift"
      via: "switch selectedTab case .history routing"
      pattern: "case \\.history.*HistoryBrowserView"
---

<objective>
Add a resizable History tab to the Settings window with search and label chip bar.

Purpose: Establishes the settings infrastructure for the full history browser -- resizable window, new tab, and the root HistoryBrowserView shell with search + chip bar reusing existing components.

Output: Settings window supports resizing, History tab appears in tab bar, clicking it shows search field and chip bar (grid comes in Plan 02).
</objective>

<execution_context>
@/Users/phulsechinmay/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phulsechinmay/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-history-browser-and-bulk-actions/12-RESEARCH.md

@Pastel/Views/Settings/SettingsWindowController.swift
@Pastel/Views/Settings/SettingsView.swift
@Pastel/Views/Panel/PanelContentView.swift
@Pastel/Views/Panel/SearchFieldView.swift
@Pastel/Views/Panel/ChipBarView.swift
@Pastel/Views/Settings/GeneralSettingsView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make settings window resizable and add History tab to SettingsView</name>
  <files>
    Pastel/Views/Settings/SettingsWindowController.swift
    Pastel/Views/Settings/SettingsView.swift
  </files>
  <action>
    **SettingsWindowController.swift:**
    1. Change the NSWindow contentRect width from 500 to 700 and height from 420 to 550 (larger default for grid).
    2. Add `.resizable` to the styleMask array: `[.titled, .closable, .resizable]`.
    3. Add `window.minSize = NSSize(width: 500, height: 480)` after setting isReleasedWhenClosed, to prevent shrinking below usable size.

    **SettingsView.swift:**
    1. Add `case history` to the SettingsTab enum.
    2. Set its iconName to `"clock.arrow.circlepath"` and displayName to `"History"`.
    3. Add routing in the switch: `case .history: HistoryBrowserView()`.
    4. Replace the fixed `.frame(minWidth: 500, maxWidth: 500, minHeight: 480, maxHeight: 600)` with conditional sizing per tab:
       - For `.general` and `.labels`: `.frame(minWidth: 500, idealWidth: 500, maxWidth: 500, minHeight: 480, maxHeight: 600)` -- keeps them fixed-width and centered.
       - For `.history`: `.frame(minWidth: 500, minHeight: 480)` -- no maxWidth, allowing it to fill the resized window.
    5. Apply the frame modifier on the Group that wraps the tab content, using a computed property or inline conditional based on `selectedTab`.

    **Important:** The SettingsTab enum is private -- that is fine, it stays private. The conditional frame must be on the content Group, not the outer VStack, so the tab bar always stretches full width.
  </action>
  <verify>
    Build succeeds with `xcodebuild -scheme Pastel build 2>&1 | tail -5` (HistoryBrowserView will be created in Task 2, so create a minimal placeholder first if needed for compilation, but Task 2 creates the real one).

    Actually -- since Task 2 creates HistoryBrowserView in the same plan, just ensure both tasks together compile. If building incrementally, a stub `struct HistoryBrowserView: View { var body: some View { Text("History") } }` in SettingsView.swift temporarily would work, but prefer doing both tasks before building.
  </verify>
  <done>
    Settings window opens at 700x550, can be resized by dragging edges/corners, has minSize 500x480. History tab appears in tab bar. General/Labels tabs stay fixed-width centered. History tab content fills available width.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create HistoryBrowserView with search and chip bar</name>
  <files>
    Pastel/Views/Settings/HistoryBrowserView.swift
  </files>
  <action>
    Create `Pastel/Views/Settings/HistoryBrowserView.swift` -- the root view for the History tab. This mirrors the composition pattern of PanelContentView but simplified (no panel-specific logic like keyboard navigation, hotkey badges, or panel actions).

    Structure:
    ```swift
    import SwiftUI
    import SwiftData

    struct HistoryBrowserView: View {
        @Query(sort: \Label.sortOrder) private var labels: [Label]

        @State private var searchText = ""
        @State private var debouncedSearchText = ""
        @State private var selectedLabelIDs: Set<PersistentIdentifier> = []

        var body: some View {
            VStack(spacing: 0) {
                // Top bar: search + chip bar
                SearchFieldView(searchText: $searchText)
                ChipBarView(labels: labels, selectedLabelIDs: $selectedLabelIDs)

                Divider()

                // Grid area (placeholder until Plan 02)
                Text("History grid coming soon")
                    .frame(maxWidth: .infinity, maxHeight: .infinity)
                    .foregroundStyle(.secondary)
            }
            .task(id: searchText) {
                try? await Task.sleep(for: .milliseconds(200))
                guard !Task.isCancelled else { return }
                debouncedSearchText = searchText
            }
        }
    }
    ```

    Key details:
    - Reuse `SearchFieldView` and `ChipBarView` directly (they accept bindings).
    - Use the same `.task(id: searchText)` debounce pattern from PanelContentView (200ms).
    - State: `searchText`, `debouncedSearchText`, `selectedLabelIDs` -- same as PanelContentView.
    - The placeholder text will be replaced by HistoryGridView in Plan 02. For now, the view compiles and shows the search + chip bar working.
    - Do NOT include PanelActions environment -- this is the settings window context, not the panel.
  </action>
  <verify>
    `xcodebuild -scheme Pastel build 2>&1 | tail -5` compiles without errors.
    Launch the app, open Settings, click History tab -- search field and chip bar appear. Typing in search field works (text appears). Label chips display if labels exist.
  </verify>
  <done>
    HistoryBrowserView exists with working search field and chip bar. Settings window is resizable. History tab is accessible from the tab bar. General and Labels tabs are unaffected at their fixed width.
  </done>
</task>

</tasks>

<verification>
1. `xcodebuild -scheme Pastel build` succeeds
2. Settings window opens with 3 tabs: General, Labels, History
3. Window can be resized by dragging edges
4. General tab stays fixed ~500pt width centered in window
5. Labels tab stays fixed ~500pt width centered in window
6. History tab expands to fill available width
7. History tab shows search field and chip bar
8. Window cannot be shrunk below 500x480
</verification>

<success_criteria>
- Settings window has `.resizable` styleMask and minSize 500x480
- SettingsTab enum has `.history` case with clock icon
- HistoryBrowserView renders search + chip bar with 200ms debounce
- General/Labels tabs maintain fixed width; History tab is flexible
- Build compiles with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-history-browser-and-bulk-actions/12-01-SUMMARY.md`
</output>
