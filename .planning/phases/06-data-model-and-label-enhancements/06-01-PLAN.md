---
phase: 06-data-model-and-label-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Pastel/Models/ClipboardItem.swift
  - Pastel/Models/Label.swift
  - Pastel/Models/LabelColor.swift
  - Pastel/Models/ContentType.swift
  - Pastel/Views/Panel/ClipboardCardView.swift
  - Pastel/Services/PasteService.swift
  - Pastel/Services/ClipboardMonitor.swift
autonomous: true

must_haves:
  truths:
    - "Existing v1.0 clipboard history and labels load without data loss after schema migration"
    - "User opens label settings and sees 12 color options (including teal, indigo, brown, mint) instead of the original 8"
    - "App builds and runs without compiler errors from new ContentType cases"
  artifacts:
    - path: "Pastel/Models/ClipboardItem.swift"
      provides: "6 new optional fields for v1.1 features"
      contains: "var detectedLanguage: String?"
    - path: "Pastel/Models/Label.swift"
      provides: "Optional emoji field on Label"
      contains: "var emoji: String?"
    - path: "Pastel/Models/LabelColor.swift"
      provides: "12-color palette enum"
      contains: "case mint"
    - path: "Pastel/Models/ContentType.swift"
      provides: "code and color content type cases"
      contains: "case code"
  key_links:
    - from: "Pastel/Models/ContentType.swift"
      to: "Pastel/Views/Panel/ClipboardCardView.swift"
      via: "switch item.type handles .code and .color"
      pattern: "case \\.code|case \\.color"
    - from: "Pastel/Models/ContentType.swift"
      to: "Pastel/Services/PasteService.swift"
      via: "switch item.type handles .code and .color"
      pattern: "case \\.code|case \\.color"
    - from: "Pastel/Models/ContentType.swift"
      to: "Pastel/Services/ClipboardMonitor.swift"
      via: "switch contentType handles .code and .color"
      pattern: "case \\.code|case \\.color"
---

<objective>
Extend the SwiftData schema for all v1.1 features and expand the label color palette from 8 to 12 colors.

Purpose: This is the foundation plan for the entire v1.1 milestone. Every subsequent phase (7, 8, 9) depends on the model fields added here. The schema migration must be seamless -- existing v1.0 data must load without data loss.

Output: Updated ClipboardItem (6 new optional fields), Label (emoji field), LabelColor (4 new colors), ContentType (2 new cases), and all switch statements fixed for exhaustiveness.
</objective>

<execution_context>
@/Users/phulsechinmay/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phulsechinmay/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-data-model-and-label-enhancements/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend SwiftData models and enums</name>
  <files>
    Pastel/Models/ClipboardItem.swift
    Pastel/Models/Label.swift
    Pastel/Models/LabelColor.swift
    Pastel/Models/ContentType.swift
  </files>
  <action>
    **ClipboardItem.swift** -- Add 6 new optional fields after the existing `label` property. All fields MUST be `Optional` with implicit nil defaults (this guarantees automatic lightweight migration with no VersionedSchema needed). Do NOT change any existing fields or the init signature for existing parameters.

    Add these properties (in this order, with doc comments):

    ```swift
    /// Detected programming language (e.g., "swift", "python"). Nil = not code.
    /// Populated by CodeDetectionService in Phase 7.
    var detectedLanguage: String?

    /// Detected color as 6-digit hex (no #). Nil = not a color value.
    /// Populated by ColorDetectionService in Phase 7.
    var detectedColorHex: String?

    /// Page title fetched from URL metadata. Nil = not fetched or not a URL.
    /// Populated by URLMetadataService in Phase 8.
    var urlTitle: String?

    /// Filename of cached favicon image on disk. Nil = not fetched.
    /// Populated by URLMetadataService in Phase 8.
    var urlFaviconPath: String?

    /// Filename of cached og:image preview on disk. Nil = not fetched.
    /// Populated by URLMetadataService in Phase 8.
    var urlPreviewImagePath: String?

    /// URL metadata fetch state: nil = not attempted, false = failed, true = succeeded.
    /// Populated by URLMetadataService in Phase 8.
    var urlMetadataFetched: Bool?
    ```

    Do NOT add these fields to the `init()` parameters. They will be nil by default and populated later by services in Phases 7 and 8.

    **Label.swift** -- Add one optional field after `sortOrder`:

    ```swift
    /// Optional emoji that replaces the color dot when set.
    /// Single emoji character (one grapheme cluster) or nil.
    var emoji: String?
    ```

    Update the `init` to accept `emoji: String? = nil` and assign it:
    - Add parameter: `init(name: String, colorName: String, sortOrder: Int, emoji: String? = nil)`
    - Add assignment: `self.emoji = emoji`

    **LabelColor.swift** -- Append 4 new cases AFTER the existing 8 (do NOT reorder existing cases -- raw values must remain stable for existing data):

    ```swift
    case teal
    case indigo
    case brown
    case mint
    ```

    Add matching entries in the `color` computed property's switch:
    ```swift
    case .teal: .teal
    case .indigo: .indigo
    case .brown: .brown
    case .mint: .mint
    ```

    All four SwiftUI colors (.teal, .indigo, .brown, .mint) are available on macOS 14+, which is the app's deployment target.

    **ContentType.swift** -- Append 2 new cases AFTER `.file`:

    ```swift
    case code
    case color
    ```

    These cases are additive. Since ContentType is stored as a raw String in ClipboardItem.contentType, no schema migration is needed -- new raw values are just new strings written to the existing column.
  </action>
  <verify>
    Build the project with `xcodebuild -project Pastel.xcodeproj -scheme Pastel build 2>&1 | tail -20`. The build will FAIL at this point due to non-exhaustive switch statements in ClipboardCardView.swift, PasteService.swift, and ClipboardMonitor.swift. This is expected -- Task 2 fixes them.

    Verify model changes by confirming the new fields exist:
    - ClipboardItem.swift contains `var detectedLanguage: String?`
    - Label.swift contains `var emoji: String?`
    - LabelColor.swift contains `case mint`
    - ContentType.swift contains `case code`
  </verify>
  <done>
    All 4 model/enum files updated with new fields and cases. Build fails only due to switch exhaustiveness in downstream files (expected, fixed in Task 2).
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix ContentType switch exhaustiveness across codebase</name>
  <files>
    Pastel/Views/Panel/ClipboardCardView.swift
    Pastel/Services/PasteService.swift
    Pastel/Services/ClipboardMonitor.swift
  </files>
  <action>
    Adding `.code` and `.color` cases to ContentType breaks 3 switch statements. Fix each one with appropriate handling:

    **ClipboardCardView.swift** -- In the `contentPreview` computed property (around line 141), the switch on `item.type` needs two new cases. For now, route both to TextCardView since actual card views (CodeCardView, ColorCardView) are built in Phase 7. Add after the `.file` case:

    ```swift
    case .code:
        TextCardView(item: item)
    case .color:
        TextCardView(item: item)
    ```

    Do NOT use a `default:` case -- explicit cases are better because the compiler will flag any future additions.

    Also check `cardMinHeight` (around line 153). If it uses a switch or pattern match on `item.type`, add `.code` and `.color` there too. Currently it's a ternary (`item.type == .image ? 120 : 80`) which doesn't need updating.

    **PasteService.swift** -- In `writeToPasteboard(item:)` (around line 94), the switch on `item.type` needs two new cases. Both .code and .color items store their content in `textContent` (same as .text), so handle them identically to the `.text` case. Add after the `.file` case:

    ```swift
    case .code, .color:
        // Code snippets and color values are stored as text
        if let text = item.textContent {
            pasteboard.setString(text, forType: .string)
        }
    ```

    **ClipboardMonitor.swift** -- In `processPasteboardContent()` (around line 165), the switch on `contentType` needs two new cases. Detection logic for code and color comes in Phase 7 -- the ClipboardMonitor will never classify items as .code or .color yet. But the switch must be exhaustive. Add after the `.image` case:

    ```swift
    case .code, .color:
        // Detection happens post-capture in Phase 7.
        // ClipboardMonitor never assigns these types directly;
        // classifyContent() only returns .text/.richText/.url/.image/.file.
        return
    ```
  </action>
  <verify>
    Build the project: `xcodebuild -project Pastel.xcodeproj -scheme Pastel build 2>&1 | tail -30`. The build MUST succeed with 0 errors.

    Then verify by running the app and copying some text, a URL, and an image. Existing clipboard capture and paste-back must still work. Open Settings > Labels and confirm the 12-color palette appears in the color menu dropdown for each label.
  </verify>
  <done>
    All switch statements on ContentType are exhaustive. Project builds clean. Existing clipboard functionality (capture, display, paste-back) works unchanged. Label settings show 12 colors in the color recolor menu.
  </done>
</task>

</tasks>

<verification>
1. `xcodebuild -project Pastel.xcodeproj -scheme Pastel build` succeeds with 0 errors
2. Launch the app -- existing clipboard history loads without crash or data loss
3. Copy text, URL, image -- all captured and displayed correctly (regression check)
4. Paste-back works for all content types (regression check)
5. Open Settings > Labels -- color menu shows 12 colors including teal, indigo, brown, mint
6. Create a new label with "mint" color -- it renders correctly in chip bar
</verification>

<success_criteria>
- Project builds with 0 errors and 0 warnings related to ContentType/LabelColor exhaustiveness
- Existing v1.0 data loads without migration failure
- 12 colors visible in label settings color picker
- All existing clipboard operations unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/06-data-model-and-label-enhancements/06-01-SUMMARY.md`
</output>
